/* Establecer el formato de fecha en el servidor de base de datos */
ALTER SESSION SET NLS_DATE_FORMAT = 'DD/MM/YYYY';

/* Crear tabla PERSONA */
CREATE TABLE persona
(
   IDPER INT GENERATED BY DEFAULT ON NULL AS IDENTITY START WITH 200 INCREMENT BY 1,
   DNIPER CHAR(8),
   NOMPER VARCHAR2(60),
   APEPER VARCHAR2(80),
   EMAPER VARCHAR2(80),
   CELPER CHAR(9),
   TIPPER CHAR(1),
   ESTPER CHAR(1) DEFAULT 'A',
   FECNACPER DATE,
   CONSTRAINT PER_PK PRIMARY KEY (IDPER)       
);
COMMIT;

drop table venta;
drop table persona;
drop table venta_detalle;
drop table producto;
drop table categoria;


CREATE TABLE venta
(
   IDVEN      INT GENERATED BY DEFAULT ON NULL AS IDENTITY INCREMENT BY 1,
   FECVEN     DATE,
   IDCLI      INT REFERENCES persona(IDPER),
   IDVEND     INT REFERENCES persona(IDPER),
   TIPPAGVEN  CHAR(1),
   ESTVEN     CHAR(1) DEFAULT 'A',
   CONSTRAINT VEN_PK PRIMARY KEY (IDVEN)       
);
COMMIT;


CREATE SEQUENCE seq_categoria
  START WITH 10
  INCREMENT BY 10;


CREATE TABLE categoria (
  IDCAT NUMBER DEFAULT seq_categoria.NEXTVAL PRIMARY KEY,
  NOMCAT VARCHAR2(60)
);
COMMIT;


CREATE TABLE producto 
(
    CODPRO  CHAR(3),
    NOMPRO   VARCHAR2(50),
    IDCATPRO    INT REFERENCES categoria(IDCAT),
    PREPRO   NUMBER(8,2),
    STOCKPRO INT ,
    ESTPRO   CHAR(1)DEFAULT 'A',
    CONSTRAINT PRO_PK PRIMARY KEY (CODPRO) 
);
COMMIT;

CREATE TABLE venta_detalle
(
   IDVENDET   INT GENERATED BY DEFAULT ON NULL AS IDENTITY START WITH 300 INCREMENT BY 1,
   IDVEN      INT REFERENCES venta(IDVEN),
   CODPRO     CHAR(3)REFERENCES producto(CODPRO),
   CANVENDET  INT,
   CONSTRAINT VENDET_PK PRIMARY KEY (IDVENDET)       
);
COMMIT;

/* Insertar registros en la tabla PERSONA */
INSERT INTO PERSONA (DNIPER, NOMPER, APEPER, EMAPER, CELPER, TIPPER, FECNACPER) VALUES ('77889955', 'Alberto', 'Solano Pariona', 'alberto.pariona@empresa.com', '99845632', 'V', '10/02/1970');
INSERT INTO PERSONA (DNIPER, NOMPER, APEPER, EMAPER, CELPER, TIPPER, FECNACPER) VALUES ('45781233', 'Alicia', 'García Campos', '', '', 'C', '20/03/1980');
INSERT INTO PERSONA (DNIPER, NOMPER, APEPER, EMAPER, CELPER, TIPPER, FECNACPER) VALUES ('15487922', 'Juana', 'Ávila Chumpitaz', 'juana.avila@gmail.com', '923568741', 'C', '06/06/1986');
INSERT INTO PERSONA (DNIPER, NOMPER, APEPER, EMAPER, CELPER, TIPPER, FECNACPER) VALUES ('22116633', 'Ana', 'Enrique Flores', 'ana.enrique@empresa.com', '', 'V', '10/02/1970');
INSERT INTO PERSONA (DNIPER, NOMPER, APEPER, EMAPER, CELPER, TIPPER, FECNACPER) VALUES ('88741235', 'Claudia', 'Perales Ortiz', 'caludia.peralez@yahoo.com', '997865042', 'c', '25/07/1981');       
INSERT INTO PERSONA (DNIPER, NOMPER, APEPER, EMAPER, CELPER, TIPPER, FECNACPER) VALUES ('45122587', 'Mario', 'Barios Martinez', 'mario.barrios@outblook.com', '986737101', 'c', '10/10/1987');       
INSERT INTO PERSONA (DNIPER, NOMPER, APEPER, EMAPER, CELPER, TIPPER, FECNACPER) VALUES ('15257021', 'Brunela', 'Tarazona Guerra', 'brunela.tarazona@gmail.com', '995234667', 'c', '06/06/1990');       
INSERT INTO PERSONA (DNIPER, NOMPER, APEPER, EMAPER, CELPER, TIPPER, FECNACPER) VALUES ('47141236', 'Alejandro', 'Jimenez Huapaya', '', '941525650', 'c', '01/05/1991');       
INSERT INTO PERSONA (DNIPER, NOMPER, APEPER, EMAPER, CELPER, TIPPER, FECNACPER) VALUES ('15352585', 'Claudia', 'Marquez Litano', 'caludia.marquez@gmail.com', '985814723', 'c', '01/10/1987');       
INSERT INTO PERSONA (DNIPER, NOMPER, APEPER, EMAPER, CELPER, TIPPER, FECNACPER) VALUES ('88741235', 'Mario', 'Rodrigez Mayo', 'mario.rodrigez@outblok.com', '997865042', 'c', '25/07/1988');       
INSERT INTO PERSONA (DNIPER, NOMPER, APEPER, EMAPER, CELPER, TIPPER, FECNACPER) VALUES ('87951237', 'Luisa', 'Guerra Ibarra', 'luisa.guerra@outblok.com', '997865042', 'c', '25/07/1995');
INSERT INTO PERSONA (DNIPER, NOMPER, APEPER, EMAPER, CELPER, TIPPER, FECNACPER) VALUES ('74149824', 'Perdo Alberto', 'Candela  Venezuela', 'pedro.candela@gmail.com', '997865042', 'c', '25/07/1975');
INSERT INTO PERSONA (DNIPER, NOMPER, APEPER, EMAPER, CELPER, TIPPER, FECNACPER) VALUES ('52290134', 'Angel Manuel', 'Rojas Avila', 'angelo.rojas@outblok.com', '997865042', 'c', '25/07/2000');
INSERT INTO PERSONA (DNIPER, NOMPER, APEPER, EMAPER, CELPER, TIPPER, FECNACPER) VALUES ('11451598', 'Hilardo Faviano', 'Avila Huapalla', '', '997865042', 'c', '25/07/2000');
INSERT INTO PERSONA (DNIPER, NOMPER, APEPER, EMAPER, CELPER, TIPPER, FECNACPER) VALUES ('75749031', 'Octavio Adan ', 'Marquez Osorio', 'octavio.marquez@outblok.com', '997865042', 'c', '25/07/2000');
INSERT INTO PERSONA (DNIPER, NOMPER, APEPER, EMAPER, CELPER, TIPPER, FECNACPER) VALUES ('55869138', 'Manolo Enrique ', 'Vazquez Saravia', 'manolo.vazquez@outblok.com', '997865042', 'c', '25/07/2000');
INSERT INTO PERSONA (DNIPER, NOMPER, APEPER, EMAPER, CELPER, TIPPER, FECNACPER) VALUES ('41568245', 'Genova Pilar ', 'Ortiz Quizpe', 'genova.ortiz@outblok.com', '997865042', 'c', '12/04/2003');
INSERT INTO PERSONA (DNIPER, NOMPER, APEPER, EMAPER, CELPER, TIPPER, FECNACPER) VALUES ('49835621', 'Oscar Cesar ', 'Quioz Savala', '', '988264986', 'c', '12/10/2004');
INSERT INTO PERSONA (DNIPER, NOMPER, APEPER, EMAPER, CELPER, TIPPER, FECNACPER) VALUES ('44994841', 'Veronica ', 'Romero Vargas ', 'Veronica.romero@outblok.com', '', 'c', '25/08/2002');

/* Insertar registros en la tabla categoria */
INSERT INTO categoria (NOMCAT) VALUES ('Abarrotes');
INSERT INTO categoria (NOMCAT) VALUES ('Carne y Pollo');
INSERT INTO categoria (NOMCAT) VALUES ('Higiene y Limpieza');
INSERT INTO categoria (NOMCAT) VALUES ('Bebidas y licores ');
INSERT INTO categoria (NOMCAT) VALUES ('Dulces y snacks ');
INSERT INTO categoria (NOMCAT) VALUES ('Electrodomesticos');


/* Insertar registros en la tabla producto */
INSERT INTO PRODUCTO (CODPRO, NOMPRO, PREPRO, STOCKPRO, IDCATPRO ) VALUES ('P01'    ,'Arroz'        ,'4,65',    '50',   '10');
INSERT INTO PRODUCTO (CODPRO, NOMPRO, PREPRO, STOCKPRO, IDCATPRO ) VALUES ('P02'    ,'Azucar'       ,'3,45',    '60',   '10');
INSERT INTO PRODUCTO (CODPRO, NOMPRO, PREPRO, STOCKPRO, IDCATPRO ) VALUES ('P03','Pollo fresco','8,70','20','10');
INSERT INTO PRODUCTO (CODPRO, NOMPRO, PREPRO, STOCKPRO, IDCATPRO ) VALUES ('P04'    ,'Lomo Fino','4,65','50','10');
INSERT INTO PRODUCTO (CODPRO, NOMPRO, PREPRO, STOCKPRO, IDCATPRO ) VALUES ('P05'    ,'Detergente Opal','4,65','50','10');
INSERT INTO PRODUCTO (CODPRO, NOMPRO, PREPRO, STOCKPRO, IDCATPRO ) VALUES ('P06'    ,'Suavisante Ariel','4,65','50','10');
INSERT INTO PRODUCTO (CODPRO, NOMPRO, PREPRO, STOCKPRO, IDCATPRO ) VALUES ('P07','Six pack cerveza en lata','4,65','50','10');
INSERT INTO PRODUCTO (CODPRO, NOMPRO, PREPRO, STOCKPRO, IDCATPRO ) VALUES ('P08','Pack Jhonnie Waker Black','4,65','50','10');
INSERT INTO PRODUCTO (CODPRO, NOMPRO, PREPRO, STOCKPRO, IDCATPRO ) VALUES ('P09','Ron Barcelo gran Añejo','4,65','50','10');
INSERT INTO PRODUCTO (CODPRO, NOMPRO, PREPRO, STOCKPRO, IDCATPRO ) VALUES ('P10','Fliete de Pechuga','4,65','50','10');
INSERT INTO PRODUCTO (CODPRO, NOMPRO, PREPRO, STOCKPRO, IDCATPRO ) VALUES ('P11','Deditos de Pechuga de pollo','4,65','50','10');
INSERT INTO PRODUCTO (CODPRO, NOMPRO, PREPRO, STOCKPRO, IDCATPRO ) VALUES ('P12','Hamburgesa premiun Parrillera','28,75','150','20');
INSERT INTO PRODUCTO (CODPRO, NOMPRO, PREPRO, STOCKPRO, IDCATPRO ) VALUES ('P13','Nugett de Pollo','10,90','100','20');
INSERT INTO PRODUCTO (CODPRO, NOMPRO, PREPRO, STOCKPRO, IDCATPRO ) VALUES ('P14','Tiras de Pechugas de Pollo','13,5','250','20');
INSERT INTO PRODUCTO (CODPRO, NOMPRO, PREPRO, STOCKPRO, IDCATPRO ) VALUES ('P15','Galletas Oreo','6,88','50','50');
INSERT INTO PRODUCTO (CODPRO, NOMPRO, PREPRO, STOCKPRO, IDCATPRO ) VALUES ('P16','Galletas Choco Donust','4,90','90','50');
INSERT INTO PRODUCTO (CODPRO, NOMPRO, PREPRO, STOCKPRO, IDCATPRO ) VALUES ('P17','Huevo de Pascua','3,40','70','50');
INSERT INTO PRODUCTO (CODPRO, NOMPRO, PREPRO, STOCKPRO, IDCATPRO ) VALUES ('P18','Bombones de Cocolate','35,9','100','50');
INSERT INTO PRODUCTO (CODPRO, NOMPRO, PREPRO, STOCKPRO, IDCATPRO ) VALUES ('P19','Detergente en Polvo Opal 6KG','50,25','250','30');
INSERT INTO PRODUCTO (CODPRO, NOMPRO, PREPRO, STOCKPRO, IDCATPRO ) VALUES ('P20','Detergente Marsella AromaTerapia 4KG','46,1','150','30');
INSERT INTO PRODUCTO (CODPRO, NOMPRO, PREPRO, STOCKPRO, IDCATPRO ) VALUES ('P21','Detergente Liquido Aroma Bebe 5L','83,85','200','30');
INSERT INTO PRODUCTO (CODPRO, NOMPRO, PREPRO, STOCKPRO, IDCATPRO ) VALUES ('P22','Jabon para labar Caricia','7,75','90','30');
INSERT INTO PRODUCTO (CODPRO, NOMPRO, PREPRO, STOCKPRO, IDCATPRO ) VALUES ('P23','Lejia Tradicional 18KG','24,75','200','30');
INSERT INTO PRODUCTO (CODPRO, NOMPRO, PREPRO, STOCKPRO, IDCATPRO ) VALUES ('P24','Jabon para labar-Bolivar','6,80','100','30');
INSERT INTO PRODUCTO (CODPRO, NOMPRO, PREPRO, STOCKPRO, IDCATPRO ) VALUES ('P25','Pack de Menestras Lentejas ','14,5','120','10');
INSERT INTO PRODUCTO (CODPRO, NOMPRO, PREPRO, STOCKPRO, IDCATPRO ) VALUES ('P26','Mayonesa Alacena  850GR','16,9','90','10');
INSERT INTO PRODUCTO (CODPRO, NOMPRO, PREPRO, STOCKPRO, IDCATPRO ) VALUES ('P27','Aceite de olova extra virgen','32,5','145','10');
INSERT INTO PRODUCTO (CODPRO, NOMPRO, PREPRO, STOCKPRO, IDCATPRO ) VALUES ('P28','Fideos Tallarin 500G','3,90','45','10');
INSERT INTO PRODUCTO (CODPRO, NOMPRO, PREPRO, STOCKPRO, IDCATPRO ) VALUES ('P29','Crema de avellanas con cacao','7,80','200','10');
INSERT INTO PRODUCTO (CODPRO, NOMPRO, PREPRO, STOCKPRO, IDCATPRO ) VALUES ('P30','Harina de Trigo sin prepar','8,1','100','10');
INSERT INTO PRODUCTO (CODPRO, NOMPRO, PREPRO, STOCKPRO, IDCATPRO ) VALUES ('P31','Maicena universal 180GR','2,90','85','10');
INSERT INTO PRODUCTO (CODPRO, NOMPRO, PREPRO, STOCKPRO, IDCATPRO ) VALUES ('P32','Harian de maiz blanco','10,5','100','10');
INSERT INTO PRODUCTO (CODPRO, NOMPRO, PREPRO, STOCKPRO, IDCATPRO ) VALUES ('P33','Leche condensada Nestle','6,20','135','10');
INSERT INTO PRODUCTO (CODPRO, NOMPRO, PREPRO, STOCKPRO, IDCATPRO ) VALUES ('P34','Durasonos en almibar','13,6','180','10');
INSERT INTO PRODUCTO (CODPRO, NOMPRO, PREPRO, STOCKPRO, IDCATPRO ) VALUES ('P35','Chicarron de Cerdo','29,5','165','20');
INSERT INTO PRODUCTO (CODPRO, NOMPRO, PREPRO, STOCKPRO, IDCATPRO ) VALUES ('P36','Apanado de pollo','37,95','130','20');
INSERT INTO PRODUCTO (CODPRO, NOMPRO, PREPRO, STOCKPRO, IDCATPRO ) VALUES ('P37','Sopa de carne','9,6','170','20');


/* Insertar registros en la tabla venta */
INSERT INTO VENTA (FECVEN, IDVEND, IDCLI, TIPPAGVEN ) VALUES ('25/04/2023','200','202','E');
INSERT INTO VENTA (FECVEN, IDVEND, IDCLI, TIPPAGVEN ) VALUES ('25/04/2023','200','204','T');
INSERT INTO VENTA (FECVEN, IDVEND, IDCLI, TIPPAGVEN ) VALUES ('25/04/2023','203','205','T');
INSERT INTO VENTA (FECVEN, IDVEND, IDCLI, TIPPAGVEN ) VALUES ('25/04/2023','203','206','E');




/* Insertar registros en la tabla venta */
INSERT INTO VENTA_DETALLE (IDVEN, CODPRO, CANVENDET) VALUES ('1','P01','2');

INSERT INTO VENTA_DETALLE (IDVEN, CODPRO, CANVENDET) VALUES ('1','P04','4');
INSERT INTO VENTA_DETALLE (IDVEN, CODPRO, CANVENDET) VALUES ('2','P06','12');
INSERT INTO VENTA_DETALLE (IDVEN, CODPRO, CANVENDET) VALUES ('2','P08','6');
INSERT INTO VENTA_DETALLE (IDVEN, CODPRO, CANVENDET) VALUES ('2','P11','16');
INSERT INTO VENTA_DETALLE (IDVEN, CODPRO, CANVENDET) VALUES ('3','P15','8');
INSERT INTO VENTA_DETALLE (IDVEN, CODPRO, CANVENDET) VALUES ('4','P09','5');
INSERT INTO VENTA_DETALLE (IDVEN, CODPRO, CANVENDET) VALUES ('4','P14','13');
INSERT INTO VENTA_DETALLE (IDVEN, CODPRO, CANVENDET) VALUES ('4','P20','10');
INSERT INTO VENTA_DETALLE (IDVEN, CODPRO, CANVENDET) VALUES ('4','P21','13');

SELECT * FROM VENTA_DETALLE;

/* Actualizar el número de celular de Mario Rodríguez Martínez por el número 922881101.*/
SELECT * FROM PERSONA WHERE IDPER = 209;

UPDATE PERSONA SET CELPER = '922881101' WHERE IDPER = 209;

SELECT * FROM PERSONA WHERE IDPER = 209;


/*  El cliente de DNI 53298147 ya cuenta con número de celular es: 977226604*/
SELECT * FROM PERSONA WHERE IDPER = 212;
UPDATE PERSONA SET CELPER = '977226604' WHERE IDPER = 212;
SELECT * FROM PERSONA WHERE IDPER = 212;


/*Eliminar lógicamente los clientes cuyo DNI son: 11453265, 15487922 y 49985471*/
SELECT * FROM PERSONA WHERE IDPER = 202
UNION ALL
SELECT * FROM PERSONA WHERE IDPER = 213
UNION ALL
SELECT * FROM PERSONA WHERE IDPER = 217;

UPDATE PERSONA SET ESTPER = 'I' WHERE IDPER IN ('202', '213', '217');

SELECT * FROM PERSONA WHERE IDPER = 202
UNION ALL
SELECT * FROM PERSONA WHERE IDPER = 213
UNION ALL
SELECT * FROM PERSONA WHERE IDPER = 217;


/*. Los clientes cuyos DNI son: 87952514, 55869321 y 74142585 han perdido su celular por
tanto debe estar en blanco*/

SELECT * FROM PERSONA WHERE IDPER = 210
UNION ALL
SELECT * FROM PERSONA WHERE IDPER = 211
UNION ALL
SELECT * FROM PERSONA WHERE IDPER = 215;

UPDATE PERSONA SET CELPER = '' WHERE IDPER IN ('210', '211', '215');

SELECT * FROM PERSONA WHERE IDPER = 210
UNION ALL
SELECT * FROM PERSONA WHERE IDPER = 211
UNION ALL
SELECT * FROM PERSONA WHERE IDPER = 215;


/*.  El cliente Oscar César Quiroz Zavala será reactivado y debemos actualizar su nuevo
correo: oscar.quiroz@yahoo.es.*/

SELECT * FROM PERSONA WHERE IDPER = 217;
UPDATE PERSONA SET ESTPER = 'A' ,EMAPER ='oscar.quiroz@yahoo.es' WHERE IDPER IN ('217');
SELECT * FROM PERSONA WHERE IDPER = 217;
/*14. Agregar los datos de los siguientes clientes y vendedor.*/

INSERT INTO PERSONA (DNIPER, NOMPER, APEPER, EMAPER, CELPER, TIPPER, FECNACPER) VALUES ('88225463', 'Gustavo Tadeo ', 'Quispe Solorsano', 'gustavo.quispe@gmail.com', '', 'v', '13/10/2001');
INSERT INTO PERSONA (DNIPER, NOMPER, APEPER, EMAPER, CELPER, TIPPER, FECNACPER) VALUES ('15753595', 'Daniela ', 'Solis Vargas', 'daniela.solis@outblook.com', '', 'c', '09/11/1993');
INSERT INTO PERSONA (DNIPER, NOMPER, APEPER, EMAPER, CELPER, TIPPER, FECNACPER) VALUES ('76314895', 'Milton Gregorio ', 'Vazquez Itoriusaga', 'milton.gregorio@yahoo.com', '974814223', 'c', '22/06/2004');
INSERT INTO PERSONA (DNIPER, NOMPER, APEPER, EMAPER, CELPER, TIPPER, FECNACPER) VALUES ('84725001', 'Veronica', 'Ancajima Araujo', 'veronica.ancajima@yahoo.com', '', 'v', '07/11/1980');
INSERT INTO PERSONA (DNIPER, NOMPER, APEPER, EMAPER, CELPER, TIPPER, FECNACPER) VALUES ('11229514', 'Felicita ', 'Marroquin Candela', 'felicita.marroquin@outblook.com', '966001472', 'v', '06/06/2006');
INSERT INTO PERSONA (DNIPER, NOMPER, APEPER, EMAPER, CELPER, TIPPER, FECNACPER) VALUES ('51436952', 'Luhana ', 'Ortiz Rodrigez', 'luana.ortiz@outblook.com', '96405017', 'c', '25/11/1980');

/*15. Actualizar el precio de la Maicena Universal 180 GR a S/. 3.50*/
SELECT * FROM PRODUCTO WHERE CODPRO = 'P31';
UPDATE PRODUCTO SET PREPRO = '3,50' WHERE CODPRO IN ('P31');
SELECT * FROM PRODUCTO WHERE CODPRO = 'P31';

/*16. Actualizar producto Detergente Opal por Detergente Opal 1/2Kg.*/

SELECT * FROM PRODUCTO WHERE CODPRO = 'P05';
UPDATE PRODUCTO SET NOMPRO = 'Detergente Opal 1/2Kg' WHERE CODPRO IN ('P05');
SELECT * FROM PRODUCTO WHERE CODPRO = 'P05';

/*17. Eliminar físicamente los productos: apanado de pollo y sopa de carne.*/
SELECT * FROM PRODUCTO WHERE CODPRO = 'P37';

DELETE FROM producto WHERE CODPRO IN 'P37';
DELETE FROM producto WHERE CODPRO IN 'P36';

/*18. Eliminar físicamente los productos de código P13, P16 y P19.*/
SELECT * FROM PRODUCTO WHERE CODPRO = 'P13'
UNION ALL
SELECT * FROM PRODUCTO WHERE CODPRO = 'P16'
UNION ALL
SELECT * FROM PRODUCTO WHERE CODPRO = 'P19';
 
DELETE FROM producto WHERE CODPRO IN ('P13', 'P16', 'P19');

/*19. Eliminar físicamente todos los productos cuyo precio sea menor e igual a 10.*/

DELETE FROM producto WHERE PREPRO <= 10;

/*20. Eliminar físicamente la categoría Electrodomésticos.*/

DELETE FROM CATEGORIA WHERE NOMCAT = 'Electrodomesticos';
SELECT * FROM CATEGORIA



